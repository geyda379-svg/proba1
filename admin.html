// admin-bot.js - –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º —á–µ—Ä–µ–∑ GitHub API
const TelegramBot = require('node-telegram-bot-api');
const axios = require('axios');
const fs = require('fs');
const path = require('path');

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const config = {
    botToken: 'YOUR_ADMIN_BOT_TOKEN',
    github: {
        token: 'YOUR_GITHUB_TOKEN',
        owner: 'YOUR_GITHUB_USERNAME',
        repo: 'telegram-webapp-store',
        branch: 'main',
        filePath: 'products.json'
    },
    adminIds: [YOUR_TELEGRAM_ID]
};

const bot = new TelegramBot(config.botToken, { polling: true });

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    
    if (!config.adminIds.includes(chatId)) {
        bot.sendMessage(chatId, '‚õî –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É.');
        return;
    }
    
    const keyboard = {
        reply_markup: {
            keyboard: [
                ['üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä', 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä'],
                ['üìã –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤', 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ'],
                ['‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å –º–∞–≥–∞–∑–∏–Ω–∞']
            ],
            resize_keyboard: true,
            one_time_keyboard: false
        }
    };
    
    bot.sendMessage(chatId, 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–º!\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', keyboard);
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
bot.onText(/üì¶ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/, async (msg) => {
    const chatId = msg.chat.id;
    
    bot.sendMessage(chatId, '–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n\n`–ù–∞–∑–≤–∞–Ω–∏–µ | –¶–µ–Ω–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ`\n\n–ü—Ä–∏–º–µ—Ä:\n`iPhone 15 | 99999 | electronics | –°–º–∞—Ä—Ç—Ñ–æ–Ω Apple`', {
        parse_mode: 'Markdown'
    });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞
bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text;
    
    if (!config.adminIds.includes(chatId)) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞
    if (text.includes('|') && text.split('|').length >= 3) {
        const parts = text.split('|').map(part => part.trim());
        
        if (parts.length >= 3) {
            const [name, price, category, ...descriptionParts] = parts;
            const description = descriptionParts.join('|') || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
            const newProduct = {
                id: 'product_' + Date.now(),
                name: name,
                price: parseFloat(price),
                category: category.toLowerCase(),
                description: description,
                image: getEmojiForCategory(category),
                created_at: new Date().toISOString(),